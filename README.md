# 软件工程课程设计-仿小米商城


# 项目背景
在当今互联网时代，电商平台已经成为了商业领域的重要一环。本项目旨在通过仿小米商城，实现一个前后端分离的电商平台，以满足用户购物、支付、物流等方面的需求。

# 项目范围
* 本项目将涉及以下主要功能：
* 普通用户的登录和注册
* 零售商店铺注册和管理
* 商品分类和展示
* 商品搜索和过滤
* 购物车管理
* 订单管理


# 需求分析

由于我们的项目是仿小米商城，所以我们分析的主体是小米商城。通过访问小米商城的页面，我们可以获知小米商城的前端页面能提供给用户什么样的功能。以下是归纳整理的用户相关的功能需求。

用户注册页，用户可以访问注册页，通过输入手机号和密码来注册账号，其中，手机号需要未注册过用户、密码需要满足包含英文字母、包含阿拉伯数字、包含特殊字符。

用户登陆页，用户可以访问登陆页，通过输入手机号和密码来登陆账号。

商城主页，显示一系列商品类别，展示部分商品列表，轮播新品广告。页面顶部有多个子选项卡，包含商品类别、秒杀商品、历史订单、我的信息。

商品类别页，显示该类别下的一系列商品，每页的商品最大显示数为50，用户可以点击单个商品来跳转到商品详情页。

商品详情页，显示该商品的详情，包括商品名，商品图片，商品单价，商品可选属性，商品状态。用户可以选择购买数量，选择商品属性，加入收藏，加入购物或直接购买。用户选择加入购物车或直接购买后，会跳转到购物车页或购买页。

商品详情页，显示该商品的详情，包括商品名，商品图片，商品单价，商品可选属性，商品状态。用户可以选择购买数量，选择商品属性，加入收藏，加入购物或直接购买。用户选择加入购物车或直接购买后，会跳转到购物车页或购买页。

收藏页，显示用户收藏的一系列商品。用户可以勾选多个商品，进行批量操作，如加入购物车，直接购买或取消收藏。支持全选。

购物车页，显示用户购物车内的一系列商品，用户可以选中多个商品，进行批量操作，如购买，移出购物车。支持全选。

购买结算页，显示用户当前正在购买结算的一系列商品，用户需设置收货详情，包括收货人姓名，电话，地址。用户点击确认结算后，会生成对应订单，同时跳转到支付页。

支付页，显示订单中的一系列商品信息以及订单总金额。用户可以选择支付方式并付款，付款成功后弹出成功提示并返回商城主页。

订单页，显示用户的一系列历史订单，用户可以点击单个订单来跳转到订单详情页。对于未支付订单，用户可以点击前往付款来跳转到支付页。

订单详情页显示对应订单的详情，包括购买商品名、商品图片、购买数量和总金额等。

我们还注意到，小米商城中所没有的一些常见的商城功能，如商品评论区等。我们决定在访小米商城中实现一些小米商城所不具有的一些功能，以增强用户体验，如下。

在商品详情页开设评论区，供已购用户分享商品使用体验等，待管理员审核通过后方可显示。（想到再补充）

一个电子商城，除了需要给用户提供清晰好用的前台界面外，还需要为商城的管理人员提供便于更新维护的后台界面。在分析时，我们发现，小米商城和我们平时常用的淘宝商城有所不同：淘宝商城是C2C（Consumer to Consumer）的，它能为个人用户提供经营资格；而小米商城是B2C的，它的经营者就是小米公司本身，不对外部用户提供经营资格。这也是小米商城的一大特点。

根据这个特点，我们对商城后台的功能需求分析如下。


整个后台系统有且仅有一个超级管理员。它的权限最大，除了具有普通管理员的权限外，他还能够创建及删除普通管理员。

后台登陆页，输入账号和密码，供后台工作人员登陆后台系统。

后台主页，提供多个项选卡，包含用户列表、商品列表、订单列表、评论列表等。

用户管理页，管理员可以进行搜索用户、查看用户、修改用户信息和删除用户的操作。

商品管理页，管理员可以进行添加商品、补货、修改商品详情、删除商品的操作。
商品管理页提供了一个子选项卡：秒杀管理。管理员可以添加秒杀商品、设置秒杀商品的数量、开始时间和结束时间。





## 用户需求

### 普通用户需求

用户能够在首页浏览商品，查看商品的详细信息和评价等内容，搜索关键词能够精确匹配相关商品。
用户能够注册、登录、注销账号，查看个人信息、订单历史、优惠券等相关信息。
用户能够将商品加入购物车、下订单、选择支付方式，以及查看订单状态和物流信息。
用户能够参与商品评价、追加评价，以及查看其他用户的评价。
用户能够享受优惠活动和促销信息，包括满减、打折、限时特价等。

### 管理员需求

管理员能够登录管理系统，进行商品、订单、用户等信息的管理，包括添加、编辑、删除商品，查看、取消订单，管理用户信息等。
管理员能够添加、编辑、删除促销信息，包括满减、打折、限时特价等。



## 功能需求

### 前台用户功能需求

首页展示：展示商品、广告、优惠信息等。
商品搜索：支持根据关键词搜索商品。
商品详情页：展示商品详细信息、评价、购买方式等。
购物车：将商品添加到购物车、修改购物车中的商品数量和删除购物车中的商品。
下订单：选择商品、填写收货信息、选择支付方式等。
订单管理：查看订单状态和物流信息。
评价晒单：评价商品并追加评价、晒单并查看其他用户的评价。

### 后台管理功能需求

商品管理：添加、编辑、删除商品，上传商品图片、设置商品参数等。
订单管理：查看订单状态、




# 功能模块（和流程设计）


## 全局异常处理



# 数据库设计（包含EAV模型）

## 用户表（user）

|   字段名    |   数据类型   |                   备注                   |
| :---------: | :----------: | :--------------------------------------: |
|   user_id   |     int      |                   主键                   |
|  username   | varchar(255) |                  用户名                  |
|  password   | varchar(255) |                   密码                   |
|   avatar    | varchar(255) |                   头像                   |
|   gender    |     enum     |              枚举值：男、女              |
|    email    | varchar(255) |                   邮箱                   |
|    phone    | varchar(255) |                  手机号                  |
| create_time |   datetime   |                 创建时间                 |
|    role     |     enum     | 枚举值：普通用户、普通管理员、超级管理员 |
|   status    |     int      |      用户状态：0正常使用、1已被冻结      |


## 商品类型表（category）

|    字段名     |     类型     |  备注  |
| :-----------: | :----------: | :----: |
| category_name | varchar(255) | 类型名 |



## 商品表（product）

|    字段名     |   数据类型   |                备注                 |
| :-----------: | :----------: | :---------------------------------: |
|  product_id   |     int      |                主键                 |
|     name      | varchar(255) |              商品名称               |
|  description  | varchar(255) |              商品描述               |
| category_name | varchar(255) |         商品类型名（外键）          |
|     price     |   decimal    |              商品价格               |
|     stock     |     int      |              商品库存               |
|     image     | varchar(255) |              商品图片               |
|    status     |     int      | 0\1\2分别对应：未发售\正常发售\缺货 |



## 商品属性表（attributes）

|     字段名      |   数据类型   |   备注   |
| :-------------: | :----------: | :------: |
|  attribute_id   |     int      |   主键   |
| attribute_name  | varchar(255) | 属性名称 |
| attribute_value |     int      |  属性值  |



## eav表

|    字段名     |   数据类型   |           备注            |
| :-----------: | :----------: | :-----------------------: |
|  product_id   |     int      | 商品ID （联合主键、外键） |
| attributes_id |     int      | 属性ID （联合主键、外键） |
|     value     | varchar(255) |          属性值           |



## 购物车表（cart）

|   字段名   | 数据类型 |           备注            |
| :--------: | :------: | :-----------------------: |
|  user_id   |   int    | 用户ID （联合主键、外键） |
| product_id |   int    | 商品ID （联合主键、外键） |
|  quantity  |   int    |         商品数量          |



## 订单表（order）

|   字段名    | 数据类型 |                         备注                          |
| :---------: | :------: | :---------------------------------------------------: |
|     id      |   int    |                         主键                          |
|   user_id   |   int    |                    用户ID （外键）                    |
| address_id  |   int    |                  收货地址ID （外键）                  |
| total_price | decimal  |                       订单总价                        |
| create_time | datetime |                       创建时间                        |
|   status    |   int    | 0\1\2\3\4分别对应：未支付\待发货\运输中\待取件\已结束 |


## 订单明细表（order_details）

|  字段名称  | 数据类型 |         说明         |
| :--------: | :------: | :------------------: |
|     id     |   int    |  订单明细ID（主键）  |
|  order_id  |   int    | 关联的订单ID（外键） |
| product_id |   int    | 关联的商品ID（外键） |
|  quantity  |   int    |       商品数量       |
|   price    | decimal  |       商品单价       |



## 收货地址表（address）

|  字段名  |   数据类型   |      备注      |
| :------: | :----------: | :------------: |
|    id    |     int      |      主键      |
| user_id  |     int      | 用户ID（外键） |
|   name   | varchar(255) |   收货人姓名   |
|  phone   | varchar(255) |  收货人手机号  |
| province | varchar(255) |      省份      |
|   city   | varchar(255) |      城市      |
| district | varchar(255) |      区县      |
|  detail  | varchar(255) |    详细地址    |



## 秒杀表（seckill）

|    字段名     |   数据类型    |      备注      |
| :-----------: | :-----------: | :------------: |
|  seckill_id   |  bigint(20)   | 秒杀id（主键） |
|  product_id   |  bigint(20)   | 商品id（外键） |
| seckill_price | decimal(10,2) |    秒杀价格    |
|  stock_count  |    int(11)    |  秒杀库存数量  |
|  start_time   |   datetime    |  秒杀开始时间  |
|   end_time    |   datetime    |  秒杀结束时间  |



# 技术选型和实现方案

## 前端技术
### vue


## 后端技术

### spring-boot
### mybatis
### Redis

使用Redis来实现分布式锁，可以避免在高并发的情况下出现超卖的问题。具体实现可以参考以下步骤：

- 获取Redis分布式锁
- 查询该商品的库存数量
- 判断库存是否足够
- 如果库存足够，则将库存数量减一，并向消息队列发送秒杀成功的消息
- 如果库存不足，则返回秒杀失败的消息

在整个流程中，获取Redis分布式锁是非常关键的一步，只有获得锁之后才能执行后续的操作。

### RabbitMQ

使用RabbitMQ来实现异步处理秒杀成功的消息，可以大大提高系统的并发能力。具体实现可以参考以下步骤：

- 启动消费者监听秒杀成功的消息队列
- 当有秒杀成功的消息到达时，消费者处理消息并将订单信息写入数据库
- 如果订单写入成功，则发送消息给用户通知秒杀成功
- 如果订单写入失败，则将库存数量加一，并重新发送消息到消息队列中，等待重新处理

通过使用RabbitMQ实现异步处理秒杀成功的消息，可以大大提高系统的并发处理能力，并避免高并发时出现数据不一致的问题。


# 接口设计

## 普通用户相关接口


## 商家相关接口


# 项目进度和风险评估